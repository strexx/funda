"use strict";var APP=APP||{};APP.start=function(){return{init:function(){APP.router.init(),APP.get.data()}}}(),APP.router=function(){function e(){routie({home:function(){APP.render.home()},pullrefresh:function(){APP.render.pullrefresh()},books:function(){APP.render.books()},"books/:id":function(e){APP.render.books(e)},search:function(){APP.render.search()},"search/:query":function(e){APP.render.search(e)},"":function(){APP.render.home()},"*":function(){var e=new HttpClient;e.get("./static/templates/404.mst").then(function(e){document.querySelector("body").innerHTML=Mustache.render(e)})["catch"](function(e){console.error(e)})}}),window.location.hash?t():document.querySelector("#home").classList.add("active"),window.addEventListener("hashchange",t,!1)}function t(){var e=Array.prototype.slice.call(document.querySelectorAll("nav li")),t=window.location.hash.substring(1).split("/"),o=document.querySelector("#"+t[0]),n=document.querySelector("main");e.forEach(function(e){e.classList.remove("active")}),o.classList.add("active"),n.classList.add("grow")}return{init:e,toggleMenu:t}}(),APP.get=function(){function e(){if(null===localStorage.getItem("data")){var e=new HttpClient;e.get(o.fullUrl()).then(function(e){localStorage.setItem("data",e)})["catch"](function(e){console.error(e)})}else t()}function t(){return JSON.parse(localStorage.getItem("data"))}var o={apiKey:"9db42680b12e928d7f15d264928414ab:16:74324547",url:"http://api.nytimes.com/svc/books/v2/lists/2010-10-01/trade-fiction-paperback.json?api-key=",fullUrl:function(){return this.url+this.apiKey}};return{data:e,localData:t}}(),APP.render=function(){function e(){var e=(APP.get.localData(),new HttpClient);e.get("./static/templates/home.mst").then(function(e){document.querySelector("main").innerHTML=Mustache.render(e)})["catch"](function(e){console.error(e)})}function t(){var e=APP.get.localData(),t=[],o=new HttpClient;e.results.forEach(function(e,o){var n={id:Math.floor(10*Math.random())+1,author:e.book_details[0].author,title:e.book_details[0].title,description:e.book_details[0].description,image:e.book_details[0].book_image,price:e.book_details[0].price};t.push(n)}),o.get("./static/templates/pullrefresh.mst").then(function(e){document.querySelector("main").style.overflow="hidden",document.querySelector("main").innerHTML=Mustache.render(e),WebPullToRefresh.init({loadingFunction:function(){return new Promise(function(e,o){var n=new XMLHttpRequest;n.open("GET","./static/templates/books.mst"),n.onload=function(){200==n.status&&setTimeout(function(){document.querySelector("#content").innerHTML=Mustache.render(n.response,{books:t})},800),e()},n.send()})}})})["catch"](function(e){console.error(e)})}function o(e){var t=APP.get.localData(),o=[],n=new HttpClient;e?n.get("./static/templates/book.mst").then(function(o){document.querySelector("main").innerHTML=Mustache.render(o,{book:{author:t.results[e].book_details[0].author,title:t.results[e].book_details[0].title,description:t.results[e].book_details[0].description,image:t.results[e].book_details[0].book_image,price:t.results[e].book_details[0].price,publisher:t.results[e].book_details[0].publisher,link:t.results[e].book_details[0].amazon_product_url}})})["catch"](function(e){console.error(e)}):(t.results.forEach(function(e,t){var n={id:t,author:e.book_details[0].author,title:e.book_details[0].title,description:e.book_details[0].description,image:e.book_details[0].book_image,price:e.book_details[0].price};o.push(n)}),n.get("./static/templates/books.mst").then(function(e){document.querySelector("main").innerHTML=Mustache.render(e,{books:o})})["catch"](function(e){console.error(e)}))}function n(e){var t=APP.get.localData(),o=new HttpClient,n=[];if(t.results.forEach(function(e,t){({id:t,title:e.book_details[0].title});n.push(e.book_details[0].title.toLowerCase())}),e){var r=_.find(t.results,function(t){return t.book_details[0].title.toLowerCase()===e.toLowerCase()});_.filter(t.results,function(e){return e.rank<6});r?o.get("./static/templates/search-detail.mst").then(function(e){document.querySelector("main").style.height="100%",document.querySelector("main").innerHTML=Mustache.render(e,{book:{author:r.book_details[0].author,title:r.book_details[0].title,description:r.book_details[0].description,image:r.book_details[0].book_image,price:r.book_details[0].price,publisher:r.book_details[0].publisher,link:r.book_details[0].amazon_product_url}}),document.querySelector("#search-box").addEventListener("keyup",function(e){13==e.keyCode&&(window.location.hash="#search/"+document.querySelector("#search-box").value)}),new Awesomplete(document.querySelector("#search-box"),{list:n})})["catch"](function(e){console.error(e)}):o.get("./static/templates/search.mst").then(function(e){document.querySelector("main").style.height="100%",document.querySelector("main").innerHTML=Mustache.render(e),document.querySelector("#error").style.display="block",document.querySelector("#search-box").addEventListener("keyup",function(e){13==e.keyCode&&(window.location.hash="#search/"+document.querySelector("#search-box").value)}),new Awesomplete(document.querySelector("#search-box"),{list:n})})["catch"](function(e){console.error(e)})}else o.get("./static/templates/search.mst").then(function(e){document.querySelector("main").style.height="100%",document.querySelector("main").innerHTML=Mustache.render(e),document.querySelector("#search-box").addEventListener("keyup",function(e){13==e.keyCode&&(window.location.hash="#search/"+document.querySelector("#search-box").value)}),new Awesomplete(document.querySelector("#search-box"),{list:n})})["catch"](function(e){console.error(e)})}return{home:e,pullrefresh:t,books:o,search:n}}(),APP.start.init();